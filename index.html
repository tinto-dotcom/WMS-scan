<!DOCTYPE html>
<html lang="sl">

<!-- 
OFFLINE CAPABILITY:
This app works offline once loaded! 
The JsBarcode library (150KB) will be cached by your browser after first load.
All warehouse data is embedded in this HTML file.
Simply save this file to your device and open it - no internet needed after first use.
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Skladišče">
    <meta name="theme-color" content="#2b6cb0">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2tsYWRpxaHEjW5pIFNrZW5lciIsInNob3J0X25hbWUiOiJTa2xhZGnFocSNZSIsInN0YXJ0X3VybCI6Ii4vIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzJkMzc0OCIsInRoZW1lX2NvbG9yIjoiIzJiNmNiMCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDUxMiA1MTInJTNFJTNDcmVjdCBmaWxsPSclMjMyYjZjYjAnIHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJy8lM0UlM0NwYXRoIGZpbGw9J3doaXRlJyBkPSdNMjU2IDgwbC0xNjAgODB2MTkybDE2MCA4MCAxNjAtODBWMTYweicvJTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <title>Skladiščni Skener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            background: #2d3748;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: #4a5568;
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .back-btn:active {
            transform: scale(0.9);
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        .header-title {
            flex: 1;
        }

        .header-title h1 {
            font-size: 24px;
            color: #2d3748;
            font-weight: 700;
            margin: 0;
        }

        .header-title p {
            font-size: 14px;
            color: #718096;
            margin-top: 4px;
        }

        /* Content */
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .content-inner {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Screen 1: Shelf Selection */
        .shelves-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .shelf-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .shelf-card:active {
            transform: scale(0.98);
        }

        .shelf-header {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 3px solid #f7fafc;
        }

        .u-shape-container {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: stretch;
        }

        .section-btn {
            flex: 1;
            max-width: 160px;
            background: #2b6cb0;
            border: none;
            color: white;
            padding: 32px 20px;
            border-radius: 12px;
            font-size: 36px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .section-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .section-btn.bridge {
            background: #c05621;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            max-width: 120px;
        }

        .section-btn:active.bridge {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .section-label {
            font-size: 13px;
            font-weight: 600;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .gap-spacer {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            font-size: 13px;
            font-weight: 600;
            max-width: 80px;
            text-align: center;
            line-height: 1.4;
        }

        /* Screen 2: 2D Map */
        .map-container {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .floor-rows {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .floor-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .floor-label {
            min-width: 110px;
            text-align: right;
            font-size: 16px;
            font-weight: 700;
            color: #4a5568;
            padding-right: 16px;
            flex-shrink: 0;
        }

        .location-box {
            flex: 1;
            max-width: 180px;
            background: #38a169;
            border: none;
            color: white;
            padding: 28px 16px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .location-box:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .location-box.bridge {
            background: #c05621;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .location-box.bridge:active {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .box-code {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .box-info {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 500;
        }

        /* Screen 3: Pallet Selection - VERTICAL */
        .pallet-container {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .pallet-vertical-grid {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 16px;
            max-width: 100%;
            margin: 0 auto;
            justify-content: center;
        }

        .pallet-vertical-grid.has-five {
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .pallet-btn {
            background: #dd6b20;
            border: none;
            color: white;
            padding: 60px 35px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
            text-align: center;
            width: 140px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pallet-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .pallet-code {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* Screen 4: QR Code */
        .qr-container {
            background: white;
            border-radius: 20px;
            padding: 40px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .location-display {
            font-size: 48px;
            font-weight: 700;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: #2b6cb0;
            border-radius: 12px;
            letter-spacing: 2px;
        }

        #barcode {
            display: block;
            margin: 0 auto 30px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 100%;
        }

        .scan-instruction {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-top: 20px;
        }

        .scan-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* Hide screens */
        .hidden {
            display: none !important;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .header-title h1 {
                font-size: 20px;
            }

            .shelf-header {
                font-size: 24px;
            }

            .section-btn {
                font-size: 28px;
                padding: 24px 16px;
                max-width: 120px;
            }

            .floor-label {
                min-width: 90px;
                font-size: 14px;
            }

            .location-box {
                max-width: 140px;
                padding: 20px 12px;
            }

            .box-code {
                font-size: 18px;
            }

            .location-display {
                font-size: 36px;
            }

            .pallet-code {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Screen 1: Shelf Selection -->
        <div id="screen1">
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>Skladiščni Skener</h1>
                        <p>Izberi lokacijo regala</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content-inner">
                    <div class="shelves-grid" id="shelvesGrid"></div>
                </div>
            </div>
        </div>

        <!-- Screen 2: 2D Map -->
        <div id="screen2" class="hidden">
            <div class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="goToScreen(1)">←</button>
                    <div class="header-title">
                        <h1 id="mapTitle">Regal A - Leva Stran</h1>
                        <p>Izberi stolpec</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content-inner">
                    <div class="map-container">
                        <div class="floor-rows" id="floorRows"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 3: Pallet Selection -->
        <div id="screen3" class="hidden">
            <div class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="goToScreen(2)">←</button>
                    <div class="header-title">
                        <h1 id="palletTitle">A.0.1.X</h1>
                        <p>Izberi paletno mesto</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content-inner">
                    <div class="pallet-container">
                        <div class="pallet-vertical-grid" id="palletGrid"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 4: QR Code -->
        <div id="screen4" class="hidden">
            <div class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="goToScreen(3)">←</button>
                    <div class="header-title">
                        <h1>Skeniraj Lokacijo</h1>
                        <p>Uporabi Zebra skener</p>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content-inner">
                    <div class="qr-container">
                        <div class="location-display" id="qrLocationCode">A.0.1.1</div>
                        <svg id="barcode"></svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Embedded JsBarcode for 100% offline capability -->
    <script>
    // Minimalna CODE128 barcode implementacija za offline uporabo
    !function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.JsBarcode=e():t.JsBarcode=e()}(this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var o=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.text=r,this.options=n}return n(t,[{key:"encode",value:function(){return this.options.data=this.data,this.options.text=this.text,{data:this.data,text:this.text}}}]),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PLATFORM=e.drawingSVG=e.drawingCanvas=void 0;var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;e.drawingCanvas=n&&n.CanvasRenderingContext2D,e.drawingSVG=n&&n.SVGElement,e.PLATFORM={canvas:!(!n||!n.HTMLCanvasElement),svg:!(!n||!n.SVGElement)}}])});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

    <script>
        const WAREHOUSE = {"A": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}, "B": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}, "C": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}, "D": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}, "E": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}, "F": {"0": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "1": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "2": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "3": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}, "4": {"1": ["1", "2"], "2": ["1", "2", "3"], "3": ["1", "2", "3"], "4": ["1", "2", "3", "4", "5"], "5": ["1", "2", "3"], "6": ["1", "2", "3"], "7": ["1", "2", "3"], "8": ["1", "2", "3"], "9": ["1", "2"]}}};

        let state = {
            shelf: null,
            section: null,
            columns: null,
            selectedBox: null
        };

        function init() {
            displayShelves();
        }

        function goToScreen(num) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`screen${i}`).classList.add('hidden');
            }
            document.getElementById(`screen${num}`).classList.remove('hidden');
            
            // Scroll to top when changing screens
            window.scrollTo(0, 0);
        }

        // Screen 1: Display shelves
        function displayShelves() {
            const container = document.getElementById('shelvesGrid');
            container.innerHTML = '';
            
            const shelves = Object.keys(WAREHOUSE).sort();
            
            shelves.forEach(shelf => {
                const card = document.createElement('div');
                card.className = 'shelf-card';
                
                const header = document.createElement('div');
                header.className = 'shelf-header';
                header.textContent = `Regal ${shelf}`;
                card.appendChild(header);
                
                const uShape = document.createElement('div');
                uShape.className = 'u-shape-container';
                
                // Left side
                const leftBtn = document.createElement('button');
                leftBtn.className = 'section-btn';
                leftBtn.innerHTML = `<div>${shelf}</div><span class="section-label">Leva</span>`;
                leftBtn.onclick = () => selectSection(shelf, 'left', [1, 2, 3]);
                uShape.appendChild(leftBtn);
                
                // Gap or Bridge
                let hasBridge = false;
                if (shelf === 'F') {
                    hasBridge = WAREHOUSE[shelf]['3'] && WAREHOUSE[shelf]['3']['4'];
                } else {
                    hasBridge = WAREHOUSE[shelf]['2'] && WAREHOUSE[shelf]['2']['4'];
                }
                
                if (hasBridge) {
                    const bridgeBtn = document.createElement('button');
                    bridgeBtn.className = 'section-btn bridge';
                    bridgeBtn.innerHTML = `<div>${shelf}</div><span class="section-label">Most</span>`;
                    bridgeBtn.onclick = () => selectSection(shelf, 'bridge', [4]);
                    uShape.appendChild(bridgeBtn);
                } else {
                    const gap = document.createElement('div');
                    gap.className = 'gap-spacer';
                    gap.innerHTML = '↓<br>Prehod<br>↓';
                    uShape.appendChild(gap);
                }
                
                // Right side
                const rightBtn = document.createElement('button');
                rightBtn.className = 'section-btn';
                rightBtn.innerHTML = `<div>${shelf}</div><span class="section-label">Desna</span>`;
                rightBtn.onclick = () => selectSection(shelf, 'right', [5, 6, 7, 8, 9]);
                uShape.appendChild(rightBtn);
                
                card.appendChild(uShape);
                container.appendChild(card);
            });
        }

        // Screen 2: Show 2D map
        function selectSection(shelf, section, columns) {
            state.shelf = shelf;
            state.section = section;
            state.columns = columns;
            
            const sectionNames = {
                'left': 'Leva Stran',
                'bridge': 'Most',
                'right': 'Desna Stran'
            };
            
            document.getElementById('mapTitle').textContent = 
                `Regal ${shelf} - ${sectionNames[section]}`;
            
            const container = document.getElementById('floorRows');
            container.innerHTML = '';
            
            const floors = Object.keys(WAREHOUSE[shelf]).sort().reverse();
            
            floors.forEach(floor => {
                const floorData = WAREHOUSE[shelf][floor];
                const hasColumns = columns.some(col => floorData[col.toString()]);
                
                if (hasColumns) {
                    const row = document.createElement('div');
                    row.className = 'floor-row';
                    
                    const label = document.createElement('div');
                    label.className = 'floor-label';
                    label.textContent = floor === '0' ? 'Pritličje' : `Nadstropje ${floor}`;
                    row.appendChild(label);
                    
                    columns.forEach(col => {
                        if (floorData[col.toString()]) {
                            const box = document.createElement('button');
                            box.className = 'location-box' + (section === 'bridge' ? ' bridge' : '');
                            
                            const boxCode = `${shelf}.${floor}.${col}`;
                            const palletCount = floorData[col.toString()].length;
                            
                            box.innerHTML = `
                                <div class="box-code">${boxCode}</div>
                                <div class="box-info">${palletCount} mest</div>
                            `;
                            box.onclick = () => selectBox(boxCode, floorData[col.toString()]);
                            
                            row.appendChild(box);
                        }
                    });
                    
                    container.appendChild(row);
                }
            });
            
            goToScreen(2);
        }

        // Screen 3: Show pallet positions VERTICALLY
        function selectBox(boxCode, positions) {
            state.selectedBox = boxCode;
            
            document.getElementById('palletTitle').textContent = `${boxCode}.X`;
            
            const container = document.getElementById('palletGrid');
            container.innerHTML = '';
            
            // Add class for 5 pallets to prevent wrapping (for bridge columns)
            if (positions.length === 5) {
                container.classList.add('has-five');
            } else {
                container.classList.remove('has-five');
            }
            
            positions.sort((a, b) => parseInt(a) - parseInt(b));
            
            positions.forEach(pos => {
                const btn = document.createElement('button');
                btn.className = 'pallet-btn';
                const fullCode = `${boxCode}.${pos}`;
                btn.innerHTML = `<div class="pallet-code">${fullCode}</div>`;
                btn.onclick = () => showQR(fullCode);
                container.appendChild(btn);
            });
            
            goToScreen(3);
        }

        // Screen 4: Display EAN Barcode
        function showQR(location) {
            document.getElementById('qrLocationCode').textContent = location;
            
            // Generate EAN-13 compatible barcode
            // For warehouse codes like A.0.1.1, we'll use CODE128 which supports text
            try {
                JsBarcode("#barcode", location, {
                    format: "CODE128",
                    width: 4,
                    height: 200,
                    displayValue: true,
                    fontSize: 32,
                    margin: 20,
                    background: "#ffffff",
                    lineColor: "#000000"
                });
            } catch (e) {
                console.error("Barcode generation error:", e);
            }
            
            goToScreen(4);
        }

        init();
    </script>
</body>
</html>
